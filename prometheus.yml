global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    monitor: "ufbrowsers-monitor"

alerting:
  alertmanagers:
    - static_configs:
        - targets: []

rule_files:
  - /etc/prometheus/rules.yml

scrape_configs:
  # Prometheus self-monitoring
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]

  # Main Application
  - job_name: "ufbrowsers-app"
    static_configs:
      - targets: ["ufbrowsers-app:3000"]
    metrics_path: "/api/metrics"
    scrape_interval: 30s

  # Browser Pool Service
  - job_name: "browser-pool"
    static_configs:
      - targets: ["browser-pool:3002"]
    metrics_path: "/health"
    scrape_interval: 30s

  # WebSocket Service
  - job_name: "websocket-service"
    static_configs:
      - targets: ["browser-websocket:3001"]
    metrics_path: "/health"
    scrape_interval: 30s

  # PostgreSQL (via postgres_exporter if available)
  - job_name: "postgres"
    static_configs:
      - targets: ["postgres:5432"]
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: postgres

  # Redis (via redis_exporter if available)
  - job_name: "redis"
    static_configs:
      - targets: ["redis:6379"]
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: redis

  # Node exporter for system metrics
  - job_name: "node"
    static_configs:
      - targets: ["host.docker.internal:9100"]
        labels:
          instance: "local-machine"
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: "docker-host"

  # Docker container metrics (if using cAdvisor)
  - job_name: "cadvisor"
    static_configs:
      - targets: ["host.docker.internal:8080"]
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: "cadvisor"
